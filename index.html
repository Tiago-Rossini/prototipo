<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Estudos - V4</title>
    <!-- Inclui o Tailwind CSS para estiliza√ß√£o r√°pida e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configura√ß√£o do Tailwind para usar a fonte Inter e cores personalizadas -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        primary: '#6B46C1', // Roxo vibrante
                        secondary: '#FFC107', // Amarelo para destaque
                        accent: '#20C997', // Verde menta para sucesso
                        background: '#F0F2F5', // Cinza claro para fundo
                        textlight: '#FFFFFF', // Texto branco
                        textdark: '#333333', // Texto escuro
                        optionbg: '#E0E7FF', // Azul claro para op√ß√µes
                        optionborder: '#C7D2FE', // Azul mais escuro para borda da op√ß√£o
                        correct: '#D1FAE5', // Fundo verde claro para resposta correta
                        wrong: '#FEE2E2', // Fundo vermelho claro para resposta errada
                        bordercorrect: '#34D399', // Borda verde para correto
                        borderwrong: '#EF4444', // Borda vermelha para errado
                        graytext: '#6B7280', // Texto cinza para descri√ß√µes
                    }
                }
            }
        }
    </script>
    <style>
        /* Define a fonte Inter diretamente para garantir que seja aplicada */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F0F2F5; /* Cor de fundo principal */
        }
        /* Anima√ß√£o simples para a caixa de motiva√ß√£o */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }
        .animate-pulse-custom {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8 bg-background">
    <div class="w-full max-w-5xl bg-white rounded-2xl shadow-xl p-6 sm:p-8 lg:p-10 flex flex-col md:flex-row gap-6">
        <!-- Se√ß√£o de Navega√ß√£o/Informa√ß√µes (Painel Lateral) -->
        <div class="md:w-1/3 flex flex-col items-center p-4 bg-primary text-textlight rounded-xl shadow-lg transform transition-all duration-300 hover:scale-105">
            <h2 class="text-3xl sm:text-4xl font-bold mb-4 text-center">üìö Meu Painel!</h2>
            <div class="text-center mb-6">
                <p class="text-lg">Ol√°, estudante!</p>
                <p class="text-md">Vamos explorar as mat√©rias!</p>
            </div>

            <!-- Pontua√ß√£o Atual -->
            <div class="w-full bg-primary-dark p-4 rounded-xl mb-6 shadow-inner">
                <p class="text-xl font-semibold text-center mb-2">Sua Pontua√ß√£o Total:</p>
                <p id="scoreDisplay" class="text-5xl font-extrabold text-secondary text-center">0</p>
            </div>

            <!-- Streak Di√°rio -->
            <div class="w-full bg-primary-dark p-4 rounded-xl mb-6 shadow-inner">
                <p class="text-xl font-semibold text-center mb-2">üî• Streak Di√°rio:</p>
                <p id="streakDisplay" class="text-5xl font-extrabold text-accent text-center">0</p>
                <p class="text-sm text-center mt-2">Sequ√™ncia de acertos!</p>
            </div>

            <!-- Barra de Progresso do M√≥dulo Ativo -->
            <div class="w-full mb-6" id="activeModuleProgressSection">
                <p class="text-xl font-semibold text-center mb-2">Progresso no M√≥dulo Atual:</p>
                <div class="w-full bg-gray-300 rounded-full h-4 sm:h-5 overflow-hidden shadow-inner">
                    <div id="moduleProgressBar" class="bg-accent h-full rounded-full transition-all duration-500 ease-out" style="width: 0%;"></div>
                </div>
                <p id="moduleProgressText" class="text-sm text-center mt-2">0/0 Perguntas</p>
            </div>

            <!-- Mensagens de Feedback/Motiva√ß√£o -->
            <div id="motivationBox" class="w-full bg-white text-textdark p-4 rounded-lg shadow-md text-center text-sm hidden animate-pulse-custom">
                "Excelente trabalho! Mantenha o ritmo para alcan√ßar seus objetivos!"
            </div>

            <!-- Se√ß√£o de Comunidade/Colabora√ß√£o (Simulada) -->
            <div class="w-full bg-white text-textdark p-4 rounded-xl shadow-md mt-6 text-center">
                <h3 class="text-xl font-bold mb-2">Comunidade</h3>
                <p class="text-gray-700 text-sm mb-3">Conecte-se com outros estudantes e tire suas d√∫vidas!</p>
                <!-- √çcone simulando chat/f√≥rum (usando um emoji para simplicidade) -->
                <p class="text-4xl">üí¨üë•</p>
                <p class="text-sm text-gray-500 mt-2">F√≥runs de discuss√£o e grupos de estudo</p>
            </div>
            <!-- Bot√£o para voltar √† lista de mat√©rias -->
            <button id="backToSubjectsButton" class="bg-indigo-600 text-textlight font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300 mt-6 hidden">
                Voltar √†s Mat√©rias
            </button>
        </div>

        <!-- Se√ß√£o Principal de Conte√∫do -->
        <div class="md:w-2/3 flex flex-col justify-between bg-white p-4 sm:p-6 rounded-xl shadow-lg">

            <!-- Tela de Lista de Mat√©rias -->
            <div id="subjectListView" class="flex flex-col flex-grow items-center justify-center transition-opacity duration-500">
                <h1 class="text-2xl sm:text-3xl font-bold text-center text-primary mb-6">Selecione uma Mat√©ria</h1>
                <div id="subjectsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-6 w-full max-w-2xl">
                    <!-- Cards das mat√©rias ser√£o injetados aqui -->
                </div>
            </div>

            <!-- Tela de Lista de M√≥dulos (para uma mat√©ria selecionada) -->
            <div id="moduleListView" class="hidden flex-col flex-grow items-center justify-center transition-opacity duration-500">
                <h1 id="moduleListTitle" class="text-2xl sm:text-3xl font-bold text-center text-primary mb-6">M√≥dulos de [Mat√©ria]</h1>
                <div id="modulesContainer" class="grid grid-cols-1 gap-4 w-full max-w-2xl">
                    <!-- Cards dos m√≥dulos ser√£o injetados aqui -->
                </div>
                 <button id="backToSubjectsFromModulesButton" class="bg-gray-400 text-textdark font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 mt-6">
                    Voltar √†s Mat√©rias
                </button>
            </div>

            <!-- Tela de Conte√∫do/Material (simulado) -->
            <div id="materialView" class="hidden flex-col flex-grow items-center justify-center transition-opacity duration-500 text-center">
                <h2 id="materialTitle" class="text-3xl sm:text-4xl font-bold text-primary mb-4">T√≠tulo do Material</h2>
                <p id="materialType" class="text-lg text-gray-700 mb-6">Tipo: V√≠deo</p>
                <div class="w-full bg-gray-200 rounded-xl p-8 flex flex-col items-center justify-center shadow-inner h-64">
                    <p class="text-gray-500 text-xl mb-4">Conte√∫do do material (simulado)</p>
                    <p class="text-gray-400">Aqui seria incorporado um v√≠deo, um PDF ou texto completo.</p>
                </div>
                <button id="backToModulesFromMaterialButton" class="bg-gray-400 text-textdark font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 mt-8">
                    Voltar aos M√≥dulos
                </button>
            </div>

            <!-- √Årea da Pergunta e Op√ß√µes (Quiz) -->
            <div id="quizContainer" class="hidden flex-col flex-grow items-center justify-center transition-opacity duration-500">
                <h2 id="quizModuleTitle" class="text-2xl sm:text-3xl font-bold text-center text-primary mb-6">Quiz do M√≥dulo: [Nome do M√≥dulo]</h2>
                <p id="questionDisplay" class="text-xl sm:text-2xl font-semibold text-textdark mb-6 text-center leading-relaxed">Carregando pergunta...</p>
                <div id="optionsContainer" class="grid grid-cols-1 sm:grid-cols-2 gap-4 w-full max-w-lg mb-8">
                    <!-- As op√ß√µes ser√£o injetadas aqui pelo JavaScript -->
                </div>
                <button id="nextQuestionButton" class="bg-secondary text-textdark font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl hover:bg-yellow-500 transition-all duration-300 transform hover:scale-105 hidden focus:outline-none focus:ring-4 focus:ring-yellow-300">
                    Pr√≥xima Pergunta
                </button>
            </div>

            <!-- Tela Final do Quiz -->
            <div id="quizEndScreen" class="hidden flex-col flex-grow items-center justify-center transition-opacity duration-500 text-center">
                <h2 class="text-3xl sm:text-4xl font-bold text-accent mb-4">üéâ Desafio Conclu√≠do!</h2>
                <p class="text-xl text-textdark mb-6">Voc√™ completou as perguntas deste m√≥dulo!</p>

                <!-- Sum√°rio de Desempenho -->
                <div class="bg-gray-100 p-4 rounded-xl mb-6 w-full max-w-sm shadow-inner">
                    <p class="text-lg font-semibold text-primary mb-2">Seu Desempenho no M√≥dulo:</p>
                    <p class="text-md text-green-600">Acertos: <span id="correctAnswersSummary" class="font-bold">0</span></p>
                    <p class="text-md text-red-600">Erros: <span id="incorrectAnswersSummary" class="font-bold">0</span></p>
                </div>

                <p class="text-2xl font-bold text-primary mb-8">Sua Pontua√ß√£o Total: <span id="finalScoreDisplay" class="text-secondary text-5xl">0</span></p>
                <button id="restartQuizButton" class="bg-primary text-textlight font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300">
                    Tentar Novamente (M√≥dulo Atual)
                </button>
                 <button id="nextModuleButton" class="bg-accent text-textdark font-bold py-3 px-8 mt-4 rounded-full shadow-lg hover:shadow-xl hover:bg-green-600 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300">
                    Ir para o Pr√≥ximo M√≥dulo
                </button>
                <button id="backToModulesFromQuizEndButton" class="bg-gray-400 text-textdark font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl hover:bg-gray-500 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-300 mt-4">
                    Voltar aos M√≥dulos
                </button>
            </div>
        </div>
    </div>

    <script>
        // Estrutura de dados para as mat√©rias, m√≥dulos, materiais e quizzes
        const subjects = [
            {
                id: 'matematica',
                name: 'Matem√°tica',
                icon: 'üìê',
                description: 'Explore o mundo dos n√∫meros, da l√≥gica e das formas. Essencial para o racioc√≠nio!',
                modules: [
                    {
                        id: 'mat-mod1',
                        name: 'M√≥dulo 1: Fundamentos da Aritm√©tica',
                        description: 'Revise opera√ß√µes b√°sicas e conceitos num√©ricos.',
                        materials: [
                            { type: 'video', title: 'V√≠deo: Adi√ß√£o e Subtra√ß√£o', url: '#' },
                            { type: 'text', title: 'Artigo: Multiplica√ß√£o e Divis√£o', url: '#' }
                        ],
                        quiz: {
                            questions: [
                                { question: "Quanto √© 7 + 5?", options: ["10", "11", "12", "13"], answer: "12" },
                                { question: "Qual o resultado de 9 x 3?", options: ["24", "27", "30", "36"], answer: "27" }
                            ]
                        }
                    },
                    {
                        id: 'mat-mod2',
                        name: 'M√≥dulo 2: Introdu√ß√£o √† √Ålgebra',
                        description: 'Compreenda vari√°veis e express√µes alg√©bricas simples.',
                        materials: [
                            { type: 'video', title: 'V√≠deo: O que √© √Ålgebra?', url: '#' },
                            { type: 'text', title: 'PDF: Exerc√≠cios de Equa√ß√µes', url: '#' }
                        ],
                        quiz: {
                            questions: [
                                { question: "Se x = 5, quanto √© 2x + 3?", options: ["10", "13", "12", "15"], answer: "13" },
                                { question: "Qual o valor de y em y - 4 = 6?", options: ["2", "10", "8", "14"], answer: "10" }
                            ]
                        }
                    }
                ]
            },
            {
                id: 'portugues',
                name: 'Portugu√™s',
                icon: 'üìö',
                description: 'Aprimore sua escrita, leitura e compreens√£o da l√≠ngua portuguesa.',
                modules: [
                    {
                        id: 'port-mod1',
                        name: 'M√≥dulo 1: Gram√°tica Essencial',
                        description: 'Regras b√°sicas de ortografia e pontua√ß√£o.',
                        materials: [
                            { type: 'video', title: 'V√≠deo: Uso da V√≠rgula', url: '#' },
                            { type: 'text', title: 'Artigo: Guia R√°pido de Acentua√ß√£o', url: '#' }
                        ],
                        quiz: {
                            questions: [
                                { question: "Qual a palavra corretamente acentuada?", options: ["cafe", "caj√°", "avo", "papeis"], answer: "caj√°" },
                                { question: "Qual o plural de 'c√£o'?", options: ["c√µes", "c√£os", "c√£es", "c√£is"], answer: "c√£es" }
                            ]
                        }
                    }
                ]
            },
            {
                id: 'historia',
                name: 'Hist√≥ria',
                icon: 'üèõÔ∏è',
                description: 'Viaje no tempo e explore os eventos que moldaram o mundo.',
                modules: [
                    {
                        id: 'hist-mod1',
                        name: 'M√≥dulo 1: O Brasil Colonial',
                        description: 'A chegada dos portugueses e os primeiros anos da col√¥nia.',
                        materials: [
                            { type: 'video', title: 'V√≠deo: Descobrimento do Brasil', url: '#' },
                            { type: 'text', title: 'Artigo: Ciclo da Cana-de-A√ß√∫car', url: '#' }
                        ],
                        quiz: {
                            questions: [
                                { question: "Em que ano o Brasil foi descoberto?", options: ["1492", "1500", "1534", "1822"], answer: "1500" }
                            ]
                        }
                    }
                ]
            }
        ];

        // Vari√°veis de estado global
        let currentSubject = null; // Objeto da mat√©ria atualmente selecionada
        let currentModule = null;  // Objeto do m√≥dulo atualmente selecionado
        let currentQuestionIndex = 0;
        let score = 0;
        let streak = 0;
        let correctAnswersInModule = 0;
        let incorrectAnswersInModule = 0;
        let selectedOptionElement = null;
        let isAnswerChecked = false;

        // Refer√™ncias aos elementos do DOM
        const scoreDisplay = document.getElementById('scoreDisplay');
        const streakDisplay = document.getElementById('streakDisplay');
        const moduleProgressBar = document.getElementById('moduleProgressBar');
        const moduleProgressText = document.getElementById('moduleProgressText');
        const motivationBox = document.getElementById('motivationBox');

        // Main views
        const subjectListView = document.getElementById('subjectListView');
        const moduleListView = document.getElementById('moduleListView');
        const materialView = document.getElementById('materialView');
        const quizContainer = document.getElementById('quizContainer');
        const quizEndScreen = document.getElementById('quizEndScreen');

        // Elements within views
        const subjectsContainer = document.getElementById('subjectsContainer');
        const moduleListTitle = document.getElementById('moduleListTitle');
        const modulesContainer = document.getElementById('modulesContainer');
        const questionDisplay = document.getElementById('questionDisplay');
        const optionsContainer = document.getElementById('optionsContainer');
        const nextQuestionButton = document.getElementById('nextQuestionButton');
        const finalScoreDisplay = document.getElementById('finalScoreDisplay');
        const restartQuizButton = document.getElementById('restartQuizButton');
        const nextModuleButton = document.getElementById('nextModuleButton');
        const correctAnswersSummary = document.getElementById('correctAnswersSummary');
        const incorrectAnswersSummary = document.getElementById('incorrectAnswersSummary');
        const materialTitle = document.getElementById('materialTitle');
        const materialType = document.getElementById('materialType');
        const quizModuleTitle = document.getElementById('quizModuleTitle');

        // Navigation buttons
        const backToSubjectsButton = document.getElementById('backToSubjectsButton');
        const backToSubjectsFromModulesButton = document.getElementById('backToSubjectsFromModulesButton');
        const backToModulesFromMaterialButton = document.getElementById('backToModulesFromMaterialButton');
        const backToModulesFromQuizEndButton = document.getElementById('backToModulesFromQuizEndButton');
        const activeModuleProgressSection = document.getElementById('activeModuleProgressSection');


        // Mensagens motivacionais
        const motivationalMessages = [
            "Excelente trabalho! Mantenha o ritmo para alcan√ßar seus objetivos!",
            "Voc√™ est√° arrasando! Cada resposta correta te leva mais longe.",
            "Continue assim! O aprendizado √© uma jornada incr√≠vel.",
            "N√£o desanime! Cada erro √© uma oportunidade para aprender e crescer. Revise o conte√∫do!",
            "Impressionante! Sua dedica√ß√£o est√° dando frutos. Explore os recursos adicionais!",
            "Quase l√°! Foco e persist√™ncia te levar√£o ao sucesso. Que tal discutir com a comunidade?",
            "Genial! Sua intelig√™ncia brilha a cada desafio. Experimente os diferentes formatos de conte√∫do!"
        ];

        /**
         * Exibe uma mensagem na caixa de feedback/motiva√ß√£o.
         * @param {string} message - A mensagem a ser exibida.
         * @param {string} type - O tipo da mensagem ('success', 'error', 'info').
         */
        function showMotivationMessage(message, type = 'info') {
            motivationBox.textContent = message;
            motivationBox.classList.remove('hidden', 'bg-correct', 'bg-wrong', 'bg-white', 'text-red-800', 'text-textlight', 'text-textdark', 'animate-pulse-custom');
            motivationBox.classList.add('block'); // Garante que a caixa de mensagem seja vis√≠vel

            if (type === 'success') {
                motivationBox.classList.add('bg-accent', 'text-textlight');
            } else if (type === 'error') {
                motivationBox.classList.add('bg-wrong', 'text-red-800');
            } else { // 'info' ou padr√£o
                motivationBox.classList.add('bg-white', 'text-textdark', 'animate-pulse-custom');
            }

            // Oculta a mensagem ap√≥s alguns segundos, mas mant√©m a √∫ltima mensagem "padr√£o" vis√≠vel.
            if (type !== 'info') {
                setTimeout(() => {
                    motivationBox.classList.add('hidden');
                    motivationBox.classList.remove('bg-correct', 'bg-wrong', 'text-red-800', 'text-textlight', 'bg-accent', 'animate-pulse-custom');
                }, 3000);
            }
        }

        /**
         * Alterna a visibilidade das diferentes se√ß√µes de conte√∫do.
         * @param {HTMLElement} showElement - O elemento a ser exibido.
         */
        function showView(showElement) {
            // Esconde todas as views primeiro
            subjectListView.classList.add('hidden');
            moduleListView.classList.add('hidden');
            materialView.classList.add('hidden');
            quizContainer.classList.add('hidden');
            quizEndScreen.classList.add('hidden');

            // Exibe o elemento desejado
            showElement.classList.remove('hidden');
            showElement.classList.add('flex'); // Garante que seja um flex container para centraliza√ß√£o
        }

        /**
         * Renderiza a lista de mat√©rias.
         */
        function renderSubjects() {
            showView(subjectListView);
            subjectsContainer.innerHTML = '';
            backToSubjectsButton.classList.add('hidden'); // Esconde o bot√£o de voltar para mat√©rias se j√° est√° na tela de mat√©rias
            activeModuleProgressSection.classList.add('hidden'); // Esconde a barra de progresso do m√≥dulo
            
            subjects.forEach(subject => {
                const subjectCard = document.createElement('div');
                subjectCard.classList.add(
                    'bg-white', 'rounded-xl', 'shadow-md', 'p-6', 'cursor-pointer',
                    'hover:shadow-lg', 'hover:scale-105', 'transition-all', 'duration-300',
                    'flex', 'flex-col', 'items-center', 'text-center', 'border-2', 'border-primary'
                );
                subjectCard.innerHTML = `
                    <p class="text-6xl mb-4">${subject.icon}</p>
                    <h3 class="text-xl font-bold text-primary mb-2">${subject.name}</h3>
                    <p class="text-graytext text-sm">${subject.description}</p>
                `;
                subjectCard.addEventListener('click', () => renderModules(subject));
                subjectsContainer.appendChild(subjectCard);
            });
        }

        /**
         * Renderiza a lista de m√≥dulos para uma mat√©ria selecionada.
         * @param {object} subject - O objeto da mat√©ria selecionada.
         */
        function renderModules(subject) {
            currentSubject = subject;
            showView(moduleListView);
            moduleListTitle.textContent = `M√≥dulos de ${subject.name}`;
            modulesContainer.innerHTML = '';
            backToSubjectsButton.classList.remove('hidden'); // Mostra o bot√£o de voltar para mat√©rias
            activeModuleProgressSection.classList.add('hidden'); // Esconde a barra de progresso do m√≥dulo

            subject.modules.forEach((module, index) => {
                const moduleCard = document.createElement('div');
                moduleCard.classList.add(
                    'bg-white', 'rounded-xl', 'shadow-md', 'p-6', 'border-2', 'border-optionborder',
                    'flex', 'flex-col', 'gap-3', 'hover:shadow-lg', 'transition-all', 'duration-300'
                );
                moduleCard.innerHTML = `
                    <h3 class="text-xl font-bold text-textdark">${module.name}</h3>
                    <p class="text-graytext text-sm mb-2">${module.description}</p>
                    <div class="flex flex-wrap gap-2 mb-4">
                        ${module.materials.map(material => `
                            <button class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full hover:bg-blue-200 transition-colors"
                                onclick="showMaterial(${JSON.stringify(material).replace(/"/g, '&quot;')})">
                                ${material.type === 'video' ? '‚ñ∂Ô∏è V√≠deo' : 'üìÑ Artigo'}
                            </button>
                        `).join('')}
                    </div>
                    <button class="bg-accent text-textdark font-bold py-2 px-4 rounded-full shadow-md hover:bg-green-600 hover:text-textlight transition-all"
                        onclick="startQuiz(${index})">
                        Iniciar Quiz
                    </button>
                `;
                modulesContainer.appendChild(moduleCard);
            });
        }

        /**
         * Exibe o material de apoio.
         * @param {object} material - O objeto do material a ser exibido.
         */
        function showMaterial(material) {
            showView(materialView);
            materialTitle.textContent = material.title;
            materialType.textContent = `Tipo: ${material.type === 'video' ? 'V√≠deo' : 'Artigo'}`;
            backToSubjectsButton.classList.remove('hidden'); // Mostra o bot√£o de voltar para mat√©rias
            activeModuleProgressSection.classList.add('hidden'); // Esconde a barra de progresso do m√≥dulo
        }

        /**
         * Inicia o quiz para um m√≥dulo espec√≠fico.
         * @param {number} moduleIndex - O √≠ndice do m√≥dulo dentro da mat√©ria atual.
         */
        function startQuiz(moduleIndex) {
            currentModule = currentSubject.modules[moduleIndex];
            currentQuestionIndex = 0;
            correctAnswersInModule = 0;
            incorrectAnswersInModule = 0;
            showView(quizContainer);
            quizModuleTitle.textContent = `Quiz do M√≥dulo: ${currentModule.name}`;
            backToSubjectsButton.classList.remove('hidden'); // Mostra o bot√£o de voltar para mat√©rias
            activeModuleProgressSection.classList.remove('hidden'); // Mostra a barra de progresso do m√≥dulo
            loadQuestion();
        }

        /**
         * Carrega a pr√≥xima pergunta no display ou encerra o quiz do m√≥dulo.
         */
        function loadQuestion() {
            optionsContainer.querySelectorAll('button').forEach(btn => btn.disabled = false);
            isAnswerChecked = false; // Reseta o estado de verifica√ß√£o da resposta

            if (currentModule && currentQuestionIndex < currentModule.quiz.questions.length) {
                const currentQuestion = currentModule.quiz.questions[currentQuestionIndex];
                questionDisplay.textContent = currentQuestion.question;
                optionsContainer.innerHTML = ''; // Limpa as op√ß√µes anteriores
                nextQuestionButton.classList.add('hidden'); // Esconde o bot√£o de pr√≥xima pergunta

                currentQuestion.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.classList.add(
                        'w-full', 'py-3', 'px-4', 'bg-optionbg', 'border-2', 'border-optionborder',
                        'rounded-xl', 'text-textdark', 'font-medium', 'text-lg', 'text-center',
                        'hover:bg-optionborder', 'hover:shadow-md', 'transition-all', 'duration-200',
                        'focus:outline-none', 'focus:ring-4', 'focus:ring-blue-200'
                    );
                    button.addEventListener('click', () => selectOption(button, option));
                    optionsContainer.appendChild(button);
                });
                selectedOptionElement = null; // Reseta a op√ß√£o selecionada
                updateProgressBar(); // Atualiza a barra de progresso
                showMotivationMessage(motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)], 'info');
            } else {
                // Todas as perguntas do m√≥dulo atual foram respondidas
                showQuizEndScreen();
            }
        }

        /**
         * Manipula a sele√ß√£o de uma op√ß√£o pelo usu√°rio.
         * @param {HTMLElement} button - O bot√£o da op√ß√£o selecionada.
         * @param {string} selectedAnswer - O texto da op√ß√£o selecionada.
         */
        function selectOption(button, selectedAnswer) {
            if (isAnswerChecked) {
                return;
            }
            isAnswerChecked = true;

            if (selectedOptionElement) {
                selectedOptionElement.classList.remove('ring-4', 'ring-blue-300', 'bg-primary-light');
            }

            selectedOptionElement = button;
            button.classList.add('ring-4', 'ring-blue-300', 'bg-primary-light');

            setTimeout(() => checkAnswer(selectedAnswer), 300);
        }

        /**
         * Verifica se a resposta selecionada est√° correta.
         * @param {string} selectedAnswer - A resposta escolhida pelo aluno.
         */
        function checkAnswer(selectedAnswer) {
            const currentQuestion = currentModule.quiz.questions[currentQuestionIndex];
            const allOptionButtons = optionsContainer.querySelectorAll('button');

            allOptionButtons.forEach(btn => btn.disabled = true);

            if (selectedAnswer === currentQuestion.answer) {
                score += 10;
                streak += 1;
                correctAnswersInModule++;
                scoreDisplay.textContent = score;
                streakDisplay.textContent = streak;
                showMotivationMessage("üéâ Correto! Voc√™ ganhou 10 pontos e manteve seu streak!", "success");

                if (selectedOptionElement) {
                    selectedOptionElement.classList.remove('bg-optionbg', 'border-optionborder', 'ring-blue-300');
                    selectedOptionElement.classList.add('bg-correct', 'border-bordercorrect', 'font-bold');
                }
            } else {
                streak = 0;
                incorrectAnswersInModule++;
                streakDisplay.textContent = streak;
                showMotivationMessage("üòï Resposta incorreta. Seu streak foi resetado. Tente novamente!", "error");

                if (selectedOptionElement) {
                    selectedOptionElement.classList.remove('bg-optionbg', 'border-optionborder', 'ring-blue-300');
                    selectedOptionElement.classList.add('bg-wrong', 'border-borderwrong', 'font-bold');
                }
                allOptionButtons.forEach(btn => {
                    if (btn.textContent === currentQuestion.answer) {
                        btn.classList.remove('bg-optionbg', 'border-optionborder');
                        btn.classList.add('bg-correct', 'border-bordercorrect', 'font-bold');
                    }
                });
            }
            nextQuestionButton.classList.remove('hidden');
        }

        /**
         * Atualiza a barra de progresso do m√≥dulo e o texto.
         */
        function updateProgressBar() {
            if (!currentModule || !currentModule.quiz) {
                moduleProgressBar.style.width = `0%`;
                moduleProgressText.textContent = `Nenhum Quiz Ativo`;
                return;
            }
            const totalQuestionsInModule = currentModule.quiz.questions.length;
            const progressInModule = (currentQuestionIndex / totalQuestionsInModule) * 100;
            moduleProgressBar.style.width = `${progressInModule}%`;
            moduleProgressText.textContent = `${currentQuestionIndex}/${totalQuestionsInModule} Perguntas`;
        }

        /**
         * Avan√ßa para a pr√≥xima pergunta ou encerra o quiz do m√≥dulo.
         */
        function goToNextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        /**
         * Mostra a tela final do quiz para o m√≥dulo atual com o sum√°rio de desempenho.
         */
        function showQuizEndScreen() {
            showView(quizEndScreen);
            finalScoreDisplay.textContent = score;

            correctAnswersSummary.textContent = correctAnswersInModule;
            incorrectAnswersSummary.textContent = incorrectAnswersInModule;

            // Encontra o √≠ndice do m√≥dulo atual dentro da mat√©ria para saber se √© o √∫ltimo
            const currentModuleIdxInSubject = currentSubject.modules.findIndex(mod => mod.id === currentModule.id);

            if (currentModuleIdxInSubject === currentSubject.modules.length - 1) {
                nextModuleButton.classList.add('hidden');
                restartQuizButton.textContent = 'Tentar Novamente Este M√≥dulo';
            } else {
                nextModuleButton.classList.remove('hidden');
                restartQuizButton.textContent = 'Tentar Novamente Este M√≥dulo';
            }
            backToSubjectsButton.classList.remove('hidden'); // Mant√©m o bot√£o de voltar para mat√©rias vis√≠vel
            activeModuleProgressSection.classList.add('hidden'); // Esconde a barra de progresso do m√≥dulo
        }

        /**
         * Reinicia o quiz para o m√≥dulo atual.
         */
        function restartCurrentModuleQuiz() {
            startQuiz(currentSubject.modules.findIndex(mod => mod.id === currentModule.id));
        }

        /**
         * Avan√ßa para o pr√≥ximo m√≥dulo.
         */
        function goToNextModule() {
            const currentModuleIdxInSubject = currentSubject.modules.findIndex(mod => mod.id === currentModule.id);
            if (currentModuleIdxInSubject < currentSubject.modules.length - 1) {
                startQuiz(currentModuleIdxInSubject + 1);
            } else {
                // Se for o √∫ltimo m√≥dulo da mat√©ria, volta para a lista de m√≥dulos
                renderModules(currentSubject);
            }
        }

        // --- Gerenciamento de Navega√ß√£o ---

        /**
         * Navega de volta para a lista de mat√©rias.
         */
        function navigateToSubjects() {
            currentSubject = null;
            currentModule = null;
            renderSubjects();
        }

        /**
         * Navega de volta para a lista de m√≥dulos da mat√©ria atual.
         */
        function navigateToModules() {
            if (currentSubject) {
                renderModules(currentSubject);
            } else {
                navigateToSubjects(); // Se n√£o h√° mat√©ria selecionada, volta para a lista de mat√©rias
            }
        }

        // --- Adi√ß√£o de Event Listeners ---
        nextQuestionButton.addEventListener('click', goToNextQuestion);
        restartQuizButton.addEventListener('click', restartCurrentModuleQuiz);
        nextModuleButton.addEventListener('click', goToNextModule);
        backToSubjectsButton.addEventListener('click', navigateToSubjects);
        backToSubjectsFromModulesButton.addEventListener('click', navigateToSubjects);
        backToModulesFromMaterialButton.addEventListener('click', navigateToModules);
        backToModulesFromQuizEndButton.addEventListener('click', navigateToModules);


        // In√≠cio da aplica√ß√£o: Carrega a lista de mat√©rias
        window.onload = () => {
            renderSubjects();
            showMotivationMessage(motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)], 'info');
            scoreDisplay.textContent = score; // Garante que a pontua√ß√£o inicial seja exibida
            streakDisplay.textContent = streak; // Garante que o streak inicial seja exibido
        };
    </script>
</body>
</html>
